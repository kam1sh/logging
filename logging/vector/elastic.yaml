api:
  enabled: true
  address: 0.0.0.0:8686

sinks:
  elastic:
    inputs:
      - feeder
      - statistics
      - storage
      - storage_access
    type: "elasticsearch"
    endpoints:
      - "https://es01:9200"
    api_version: v8
    auth:
      strategy: basic
      user: elastic
      password: changeme
    compression: gzip
    bulk:
      index: "vector-%Y-%m-%d"
    tls:
      ca_file: /ca/ca/ca.crt

sources:
  feeder_f:
    type: file
    read_from: beginning
    include:
    - /logs/feeder.json
  storage_access_f:
    type: file
    read_from: beginning
    include:
    - /logs/storage-access.json
  storage_f:
    type: file
    read_from: beginning
    include:
    - /logs/storage.json
  statistics_f:
    type: file
    read_from: beginning
    include:
    - /logs/statistics.json
transforms:
  feeder:
    type: remap
    inputs:
    - feeder_f
    source: |
      .message = parse_json!(.message)
      .service = "feeder"
  statistics:
    type: remap
    inputs:
    - statistics_f
    source: |
      .message = parse_json!(.message)
      .service = "statistics"
  storage:
    type: remap
    inputs:
    - storage_f
    source: |
      .message = parse_json!(.message)
      .service = "storage"
      .log_type = "app"
  storage_access:
    type: remap
    inputs:
    - storage_access_f
    source: |
      .message = parse_json!(.message)
      .service = "storage"
      .log_type = "access"

